syntax = "proto3";
package proto;

message Empty {}

service Integration {
    rpc Init(IntegrationInitReq) returns (Empty);
    rpc Export(IntegrationExportReq) returns (IntegrationExportResp);    
}

message IntegrationInitReq {
    uint32 server_id = 1;
}

message IntegrationExportReq {
    bytes integration_config_json = 1;
    IntegrationExportReqPinpointConfig pinpoint_config = 2;   
}

message IntegrationExportReqPinpointConfig {
    string customer_id = 1;
}

message IntegrationExportResp {
    bytes integration_new_config_json = 1;
}

service Agent {
    rpc ExportStarted(ExportStartedReq) returns (ExportStartedResp);

    rpc ExportDone(ExportDoneReq) returns (Empty);

    rpc SendExported(SendExportedReq) returns (Empty);

    rpc ExportGitRepo(ExportGitRepoReq) returns (Empty);
}

message LastProcessed {
    string data_str  = 1;
}

message ExportStartedReq {
    string model_type = 1;    
}

message ExportStartedResp {
    string session_id = 1;
    LastProcessed last_processed = 2;
}

message ExportDoneReq {
    string session_id = 1;
    LastProcessed last_processed = 2;
}

message SendExportedReq {
    string session_id = 1;
    repeated ExportObj objs = 3; 
}

message ExportObj {
    enum DataType {
        JSON = 0;
        AVRO = 1;
    }
    DataType data_type = 1;
    bytes data = 2;
}

message ExportGitRepoReq {
    string repo_id = 1;
    string url = 2;
}

